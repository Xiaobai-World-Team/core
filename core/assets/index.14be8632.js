import{r as e,X as t,o as i,a as n,c as o,b as a,F as s,d,t as r,e as l,f as u,g as c,h as w,l as p,i as v,u as m,j as b,k as x,w as g,v as h,m as f}from"./vendor.040be4b9.js";var k,y;!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(i){const n=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((i,a)=>{const s=new URL(e,n);if(self[t].moduleMap[s])return i(self[t].moduleMap[s]);const d=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){a(new Error(`Failed to import: ${e}`)),o(r)},onload(){i(self[t].moduleMap[s]),o(r)}});document.head.appendChild(r)})),self[t].moduleMap={}}}("/core/assets/"),Object.defineProperty(window,"xiaobaiApi",{value:{}}),(y=k||(k={})).video="video",y.image="image";const E=e({visible:!1,x:0,y:0,menus:[]});document.addEventListener("contextmenu",(e=>{e.preventDefault(),document.title=Math.random().toString(),E.value.x=e.pageX,E.value.y=e.pageY}),{capture:!0}),window.xiaobaiApi.TrackPopupMenu=function(e){E.value.menus=e,E.value.visible=!0},window.xiaobaiApi.FileSystem=new t,window.xiaobaiApi.FileSystem.mkDir("/xiaobai"),window.addEventListener("message",(e=>{"CONTEXT_MENU"===e.data.type&&(E.value.menus=e.data.data)}));var M={setup(){const t=e(null);return i((()=>{document.addEventListener("mousedown",(e=>{if(!t.value)return;const i=e.target;null!==i&&(t.value.contains(i)||(E.value.visible=!1))})),document.addEventListener("click",(e=>{const i=e.target;null!==i&&t.value&&t.value.contains(i)&&(E.value.visible=!1)}))})),{root:t,contextMenus:E}},methods:{contextMenuItemClick(e){e.callback(e)}}};M.render=function(e,t){return e.contextMenus.visible?(n(),o("div",{key:0,ref:"root",id:"xiaobai-context-menu",style:{left:`${e.contextMenus.x}px`,top:`${e.contextMenus.y}px`}},[a("ul",null,[(n(!0),o(s,null,d(e.contextMenus.menus,(t=>(n(),o("li",{onClick:i=>e.contextMenuItemClick(t),key:t.id},r(t.text),9,["onClick"])))),128))])],4)):l("",!0)};const X=u.create();X.interceptors.request.use((e=>e)),X.interceptors.response.use((e=>e),(e=>Promise.reject(e.response)));const C=e(),L=e(!1);c(C),async function(){const e=await X.get("/user/info");e.data.email&&(C.value=e.data)}();const W={setup:()=>({loginModelVisible:L})},A={key:0,id:"xiaobai-login-modal"};W.render=function(e,t,i,a,s,d){return a.loginModelVisible?(n(),o("div",A,"Login")):l("",!0)};const Y=e(68),I=w((()=>Y.value+"px"));var P,S,O,T;(S=P||(P={})).NEW_FOLDER="NEW_FOLDER",S.CREATE_TXT="CREATE_TXT",(T=O||(O={})).CLOSE_WINDOW="CLOSE_WINDOW",T.MIN="MIN",T.MAX="MAX";const _=e([]),z=e(""),D=new Map,R=new Map;p().then((e=>{console.log(e)})).catch((e=>{}));const N=v({props:{order:{type:String,required:!0}},setup(){const t=e([]);return u.get("/store/getAppList").then((e=>{t.value=e.data.data})),{openApp:function(e){const t=`xiaobai-window-${Date.now().toString(36)+Math.random().toString(36).substring(2,20)}`;_.value.push({id:t,mountPointId:`${t}-mount-point`,name:e.name,x:Math.random()*(document.body.offsetWidth/1.5),y:Math.random()*(document.body.offsetHeight/1.5),width:300,height:300,active:!1,title:e.title,visible:!0,animation:!0,icon:e.favicon,jsEntry:e.jsEntry,css:e.css,isUsed:!1,autoStart:!1,appRootPath:e.appRootPath})},appList:t,showFileMenu:function(e){e.stopPropagation(),window.xiaobaiApi.TrackPopupMenu([{id:"xx",text:"打开应用",disable:!0,callback:()=>{}}])},activeWindowsId:z,taskbarWidthForPx:I}},mounted(){this.$el.addEventListener("contextmenu",(e=>{e.preventDefault(),window.xiaobaiApi.TrackPopupMenu([{id:P.NEW_FOLDER,text:"Create Folder",disable:!0,callback(e){console.log(e)}},{id:P.CREATE_TXT,text:"Create Text File",disable:!0,callback(e){console.log(e)}}])}))}}),F=()=>{m((e=>({"2aef7134":e.taskbarWidthForPx})))},j=N.setup;N.setup=j?(e,t)=>(F(),j(e,t)):F;function $(e){z.value=e}function U(e){e.preventDefault()}N.render=function(e,t,i,l,u,c){return n(),o("div",{class:"xiaobai-world-desktop",onClick:t[1]||(t[1]=t=>e.activeWindowsId="")},[(n(!0),o(s,null,d(e.appList,(t=>(n(),o("div",{class:"app",onClick:i=>e.openApp(t),key:t._id},[a("img",{src:t.favicon},null,8,["src"]),a("span",null,r(t.name),1)],8,["onClick"])))),128))])},document.addEventListener("mousedown",(e=>{let t=e.target;if(t instanceof Element!=!1)if(Array.from(t.classList).includes("xiaobai-window-wrapper"))$(t.id);else for(;null!==t&&(t=t.parentNode,t)&&"BODY"!==t.nodeName;)if(Array.from(t.classList).includes("xiaobai-window-wrapper")){$(t.id);break}})),document.addEventListener("mousedown",(function(e){if(null===e.target)return;const t=e.target,i=t.getAttribute("xiaobai-resize-trigger");if(null===i)return;e.preventDefault(),e.stopPropagation();const n=t.parentNode.id,o=_.value.findIndex((e=>e.id===n)),a=_.value[o];a.animation=!1;var s={left:a.x,top:a.y,width:a.width,height:a.height},d=e.pageX,r=e.pageY,l=s.left,u=s.top,c=s.left+s.width,w=s.top+s.height;!function(){document.addEventListener("selectstart",U),document.addEventListener("dragstart",U);var e={startX:s.left,startY:s.top,endX:c,endY:w};function t(t){switch(i){case"e":e.endX=c+(t.pageX-d);break;case"s":e.endY=w+(t.pageY-r);break;case"w":e.startX=l-(d-t.pageX);break;case"n":e.startY=u-(r-t.pageY);break;case"nw":e.startX=l-(d-t.pageX),e.startY=u-(r-t.pageY);break;case"sw":e.startX=l-(d-t.pageX),e.endY=w+(t.pageY-r);break;case"se":e.endX=c+(t.pageX-d),e.endY=w+(t.pageY-r);break;case"ne":e.endX=c+(t.pageX-d),e.startY=u-(r-t.pageY);break;case"move":return a.x=e.startX+(t.pageX-d),a.y=e.startY+(t.pageY-r),a.x<=Y.value&&(a.x=Y.value),void(a.y<=0&&(a.y=0))}var n={left:e.startX<e.endX?e.startX:e.endX,top:e.startY<e.endY?e.startY:e.endY,width:e.startX<e.endX?e.endX-e.startX:e.startX-e.endX,height:e.startY<e.endY?e.endY-e.startY:e.startY-e.endY};a.x=n.left,a.y=n.top,a.width=n.width,a.height=n.height}document.addEventListener("mousemove",t),document.addEventListener("mouseup",(function e(){document.removeEventListener("selectstart",U),document.removeEventListener("dragstart",U),document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e),a.animation=!0}))}()}));var q=v({props:{window:{type:Object,required:!0}},setup(){function e(e){const t=_.value.findIndex((t=>t.id===e)),i=_.value[t].name,n=_.value[t].css;_.value.splice(t,1),console.log(_.value,_.value.some((e=>e.name===i))),(!_.value.some((e=>e.name===i))||_.value.length<1)&&(console.log("开始移除"),n.forEach((e=>{var t;let i=document.querySelector(`link[href="${e}"]`);null==(t=null==i?void 0:i.parentNode)||t.removeChild(i)})))}function t(e){const t=_.value.findIndex((t=>t.id===e));_.value[t].visible=!1}function i(e){const t=_.value.findIndex((t=>t.id===e)),i=_.value[t];if(i.previousWindowSize)return i.x=i.previousWindowSize.x,i.y=i.previousWindowSize.y,i.width=i.previousWindowSize.width,i.height=i.previousWindowSize.height,void(i.previousWindowSize=void 0);i.previousWindowSize={x:i.x,y:i.y,width:i.width,height:i.height},i.x=Y.value,i.y=0,i.width=window.innerWidth-Y.value,i.height=window.innerHeight}return{close:e,min:t,max:i,toolbarContextMenu:function(n,o){n.preventDefault(),window.xiaobaiApi.TrackPopupMenu([{id:O.CLOSE_WINDOW,text:"Close Window",disable:!0,callback:()=>{e(o)}},{id:O.MAX,text:"max",disable:!0,callback(){i(o)}},{id:O.MIN,text:"min",disable:!0,callback(){t(o)}}])},windows:_,activeWindowsId:z}}});const H=a("div",{"xiaobai-resize-trigger":"e"},null,-1),B=a("div",{"xiaobai-resize-trigger":"s"},null,-1),V=a("div",{"xiaobai-resize-trigger":"w"},null,-1),J=a("div",{"xiaobai-resize-trigger":"n"},null,-1),G=a("div",{"xiaobai-resize-trigger":"ne"},null,-1),K=a("div",{"xiaobai-resize-trigger":"nw"},null,-1),Q=a("div",{"xiaobai-resize-trigger":"sw"},null,-1),Z=a("div",{"xiaobai-resize-trigger":"se"},null,-1);q.render=function(e,t,i,d,l,u){return n(),o(s,null,[a("div",{"xiaobai-resize-trigger":"move",onContextmenu:t[1]||(t[1]=t=>e.toolbarContextMenu(t,e.window.id)),onDblclick:t[2]||(t[2]=t=>e.max(e.window.id)),class:"xiaobai-window-toolbar"},[a("img",{class:"xiaobai-window-toolbar-icon",src:e.window.icon},null,8,["src"]),b(" "+r(e.window.title),1)],32),a("div",{"xiaobai-resize-trigger":"move",onContextmenu:t[6]||(t[6]=t=>e.toolbarContextMenu(t,e.window.id)),onDblclick:t[7]||(t[7]=t=>e.max(e.window.id))},[a("div",{class:"close",title:"Close",onClick:t[3]||(t[3]=t=>e.close(e.window.id))}),a("div",{class:"min",title:"Min",onClick:t[4]||(t[4]=t=>e.min(e.window.id))}),a("div",{class:"max",title:"Max",onClick:t[5]||(t[5]=t=>e.max(e.window.id))})],32),H,B,V,J,G,K,Q,Z],64)};var ee=v({props:{window:{type:Object,required:!0}},mounted(){new MutationObserver(((e,t)=>{t.disconnect(),this.window.isUsed=!0})).observe(this.$refs.content,{childList:!0}),this.window.css.forEach((e=>{var t;if(document.querySelector(`link[href="${e}"]`))return;let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,null==(t=document.querySelector("head"))||t.appendChild(i)})),function(e){if(R.get(e))return Promise.resolve();D.has(e)||D.set(e,[]);const t=D.get(e);return new Promise((i=>{var n;if(0===(null==t?void 0:t.length)){const t=document.createElement("script");t.type="module",t.setAttribute("crossorigin",""),t.src=e,t.onload=()=>{var t;null==(t=D.get(e))||t.forEach((e=>e())),D.delete(e),R.set(e,!0)},null==(n=document.querySelector("head"))||n.appendChild(t)}null==t||t.push((()=>i()))}))}(this.window.jsEntry).then((()=>{window.postMessage({XIAOBAI_EVENT:"XIAOBAI_APP_JAVASCRIPT_ENTRY_LOADED",mountPointId:this.window.mountPointId,windowId:this.window.id,name:this.window.name,title:this.window.title,appRootPath:this.window.appRootPath},"*")}))}});ee.render=function(e,t){return n(),o("div",{class:["xiaobai-world-window-content",{"xiaobai-world-unused-window":!1===e.window.isUsed}],name:e.window.name,ref:"content",id:e.window.mountPointId},null,10,["name","id"])};var te=v({setup:()=>({windows:_,activeWindowsId:z}),components:{windowsHandler:q,windowContent:ee}});te.render=function(e,t,i,r,l,u){const c=x("windowContent"),w=x("windowsHandler");return n(!0),o(s,null,d(e.windows,(t=>g((n(),o("div",{id:t.id,key:t.id,class:["xiaobai-window-wrapper",{xiaobaiWindowActive:e.activeWindowsId===t.id,animation:t.animation}],style:{position:"fixed",left:t.x+"px",top:t.y+"px",width:t.width+"px",height:t.height+"px"}},[a(c,{window:t},null,8,["window"]),a(w,{window:t},null,8,["window"])],14,["id"])),[[h,t.visible]]))),128)};const ie=v({setup:()=>({showWindow:function(e){z.value=_.value[e].id,_.value[e].visible=!0},windows:_,activeWindowsId:z,taskbarWidthForPx:I})}),ne=()=>{m((e=>({"46ab68ec":e.taskbarWidthForPx})))},oe=ie.setup;ie.setup=oe?(e,t)=>(ne(),oe(e,t)):ne;const ae={id:"xiaobai-world-taskbar"},se={class:"xiaobai-world-taskbar-app-item"};ie.render=function(e,t,i,r,l,u){return n(),o("div",ae,[(n(!0),o(s,null,d(e.windows,((t,i)=>(n(),o("div",{class:["xiaobai-world-taskbar-app",{xiaobaiTaskbarAppActive:e.activeWindowsId===t.id}],key:t.id,onClick:t=>e.showWindow(i)},[a("div",se,[a("img",{src:t.icon},null,8,["src"])])],10,["onClick"])))),128))])};var de=v({name:"XiaobaiWorld",components:{contextMenu:M,login:W,desktop:N,windows:te,taskbar:ie},setup:()=>({applications:e([]),activeedApplicationHandle:e("")}),mounted(){}});const re={id:"xiaobai-world-root"},le={id:"xiaobai-workd-desktop-wrapper"};de.render=function(e,t,i,d,r,l){const u=x("desktop"),c=x("taskbar"),w=x("contextMenu"),p=x("login"),v=x("windows");return n(),o(s,null,[a("div",re,[a("div",le,[a(u,{order:"1"})])]),a(c),a(w),a(p),a(v)],64)},f(de).mount("#app");
